<div>
    <p class="text-center"><b>TRONGATE FRAMEWORK DOCUMENTATION</b></p>
    <h1>Table Of Contents</h1>
    <div class="toc-grid">
        <?php
        foreach($table_of_contents as $chapter) {
?>


<div class="card">
  <div class="card-body">
    <h2><?= $chapter['dir_label'] ?></h2>

    <ul>
        <?php
        $root_url = BASE_URL;
        $files = $chapter['files'];

        if (count($files) > 0) {
            foreach($files as $file) {
                $page_url = $root_url.'/'.$file;
                $page_label = $file;
                echo '<li><a href="'.$page_url.'">'.$page_label.'</a></li>';
            }
        }
        ?>
    </ul>
  </div>
</div>

<?php
        }
        ?>
    </div>

</div>


<script>
const tocGrid = document.querySelector('.toc-grid');
let chapterCounter = 0;
let pageCounter = 0;

function buildTableOfContents(responseText) {
    const tableOfContents = JSON.parse(responseText);

    // Clear the existing table of contents grid.
    while(tocGrid.firstChild) {
        tocGrid.removeChild(tocGrid.firstChild);
    }

    tableOfContents.forEach(chapterObj => {
        chapterCounter++;
 
        const chapterCard = document.createElement('div');
        chapterCard.setAttribute('class', 'card');
        tocGrid.appendChild(chapterCard);

        const cardBody = document.createElement('div');
        cardBody.setAttribute('class', 'card-body');
        chapterCard.appendChild(cardBody);

        const cardHealineEl = document.createElement('h2');
        const cardHeadline = '<span>Chapter ' + chapterCounter + ' -</span> ' + chapterObj.dir_label;
        cardHealineEl.innerHTML = cardHeadline;
        cardBody.appendChild(cardHealineEl);

        const pages = chapterObj.pages;
        if (pages.length > 0) {
            // Build up a list of the pages that belong to the chapter.
            const pageList = document.createElement('ul');
            cardBody.appendChild(pageList);

            pages.forEach(pageObj => {
                pageCounter++;
                const pageListItem = document.createElement('li');
                const spanLhs = document.createElement('span');
                const pageLink = document.createElement('a');
                pageLink.setAttribute('href', pageObj.page_url);
                pageLink.innerText = pageObj.page_label;
                spanLhs.appendChild(pageLink);
                pageListItem.appendChild(spanLhs);

                const spanRhs = document.createElement('span');
                spanRhs.setAttribute('class', 'page-num');
                spanRhs.innerText = pageCounter;
                pageListItem.appendChild(spanRhs);

                pageList.appendChild(pageListItem);
            });
        }
    });

}

const targetUrl = '../docs_api.php';

const params = {
    action: 'return table of contents',
    removeRefs: true
}

const http = new XMLHttpRequest();
http.open('post', targetUrl);
http.setRequestHeader('Content-type', 'application/json');
http.send(JSON.stringify(params));
http.onload = function() {
    buildTableOfContents(http.responseText);
}


</script>