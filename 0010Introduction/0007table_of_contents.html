<div>
    <p class="text-center"><b>TRONGATE FRAMEWORK DOCUMENTATION</b></p>
    <h1>Table Of Contents</h1>
    <div class="toc-grid"><div class="spinner mt-3"></div></div>
    <style>
        .toc-grid {
        margin-top: 33px;
        display: grid;
        grid-template-columns: repeat(1fr);
        grid-gap: 1em;
        }
        .toc-grid h4 {
        margin-bottom: 0;
        padding-bottom: 0;
        }
        .toc-grid h2 {
        margin-top: 0;
        padding-top: 0;
        }
        .toc-grid ul {
        list-style-type: none;
        font-size: 0.9em;
        font-weight: bold;
        }
        .toc-grid li {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px #111 dotted;
        margin-bottom: 12px;
        }
        .toc-grid li a {
        color: var(--primary);
        }
        .toc-grid li a {
        text-decoration: none;
        }
        .toc-grid li a:hover {
        color: var(--primary-darker);
        }
        .toc-grid .card-heading {
        background-color: var(--primary-darker);
        }
        .page-num {
        font-weight: bold;
        font-size: 0.8em;
        }
    </style>
</div>


<script>
const tocGrid = document.querySelector('.toc-grid');
let chapterCounter = 0;
let pageCounter = 0;

function buildTableOfContents(responseText) {
    const tableOfContents = JSON.parse(responseText);

    // Clear the existing table of contents grid.
    while(tocGrid.firstChild) {
        tocGrid.removeChild(tocGrid.firstChild);
    }

    tableOfContents.forEach(chapterObj => {
        console.log('yes');
    });



    tableOfContents.forEach(chapterObj => {
        chapterCounter++;
 
        const chapterCard = document.createElement('div');
        chapterCard.setAttribute('class', 'card');
        tocGrid.appendChild(chapterCard);

        const cardBody = document.createElement('div');
        cardBody.setAttribute('class', 'card-body');
        chapterCard.appendChild(cardBody);

        const cardHealineEl = document.createElement('h2');
        const cardHeadline = '<span>Chapter ' + chapterCounter + ' -</span> ' + chapterObj.dir_label;
        cardHealineEl.innerHTML = cardHeadline;
        cardBody.appendChild(cardHealineEl);

        const pages = chapterObj.pages;
        if (pages.length > 0) {
            // Build up a list of the pages that belong to the chapter.
            const pageList = document.createElement('ul');
            cardBody.appendChild(pageList);

            pages.forEach(pageObj => {
                pageCounter++;
                const pageListItem = document.createElement('li');
                const spanLhs = document.createElement('span');
                const pageLink = document.createElement('a');
                pageLink.setAttribute('href', pageObj.page_url);
                pageLink.innerText = pageObj.page_label;
                spanLhs.appendChild(pageLink);
                pageListItem.appendChild(spanLhs);

                const spanRhs = document.createElement('span');
                spanRhs.setAttribute('class', 'page-num');
                spanRhs.innerText = pageCounter;
                pageListItem.appendChild(spanRhs);

                pageList.appendChild(pageListItem);
            });
        }
    });

}

const targetUrl = '../docs_api.php';

const params = {
    action: 'return table of contents'
}

const http = new XMLHttpRequest();
http.open('post', targetUrl);
http.setRequestHeader('Content-type', 'application/json');
http.send(JSON.stringify(params));
http.onload = function() {
    buildTableOfContents(http.responseText);
}


</script>